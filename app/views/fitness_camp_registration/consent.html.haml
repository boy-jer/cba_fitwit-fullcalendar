- title "Registration step 4 of 7: Health History"

- present @cart do |cart_presenter|

  - content_for :right_column do
    .info_box.info_box1.rounded
      .content_box
        %br.clear
        #reported_problems
          - if @user.health_issues.size > 0
            = cart_presenter.show_health_problems(@user)
        #unreported
          - unless @user.health_issues.size == MedicalCondition.all.size
            %h4 You did not report any previous:
            = cart_presenter.show_clear_health(@user)
        %br.clear
  %p
    Before completing registration, it is important that you have reported an up-to-date
    health history. If you have submitted a health history before, please let us know if anything has changed.
    Of course, your information will be protected and only used to help us tailor our program
    to your fitness needs.

  - if @membership

    %p
      As a FitWit Club member, it is important that you keep us informed of
      any change in your medical status. Please fill out the Health Consent
      questions and update your Health History as necessary. We will send
      you an e-mail reminder prior to each camp to keep your Health Consent
      and Health History current.

  #verify_health_history
    %h4 Medical Conditions
    = simple_form_for @user, url: fitness_camp_registration_release_and_waiver_of_liability_path, html:  {class: 'form-horizontal', id: 'health_status'} do |f|
      %p In the past, you have reported:
      .well
        = f.simple_fields_for :health_issues, @all_health_issues do |builder|
          .health_issue_parent
            - e = builder.object.persisted? || @user.errors.size > 0
            = builder.input :medical_condition_id, as: :hidden
            = builder.input :has_it, as: :boolean, label: builder.object.medical_condition.name, input_html: { value: e ? '1' : '0', class: 'health_condition'}
            .explain_yourself{style: "display:#{e ? 'block' : 'none'};"}
              = builder.input :explanation, as: :text, input_html: {rows: 3, style: "width:350px;", class: "required"}
            = builder.input :_destroy, as: :hidden, input_html: {class: 'destroy_field', value: e ? 'false' : 'true'}
      #order_details
        %h4 Current Health Status
        .well
          = f.input :fitness_level, collection: 1..10, include_blank: false, hint: "10 = highest fitness possible"
          = f.input :has_physician_approval, as: :radio_buttons, label: "Physician approval?", hint: 'Does your physician approve of your participation in this exercise program?', input_html: {id: "physician_approves"}
          #explain_pa{style: "display:#{@user.has_physician_approval? ? "none" : "block"};"}
            = f.input :has_physician_approval_explanation, as: :text, label: "Please explain", input_html: {rows: 3, style: "width:350px;", class: 'required'}, hint: "Required"
          = f.input :meds_affect_vital_signs, as: :radio_buttons, label: "Meds affect vital signs?", hint: 'List all that affect your vital signs (heart rate, blood pressure, breathing, etc.) or physical performance', input_html: {id: "meds_affect"}
          #explain_ma{style: "display:#{@user.meds_affect_vital_signs? ? "block" : "none"};"}
            = f.input :meds_affect_vital_signs_explanation, as: :text, label: "Please explain", input_html: {rows: 3, style: "width:350px;", class: 'required'}, hint: "Required"
          - if @user.gender == :female
            = f.input :post_menopausal_female, as: :radio_buttons
            = f.input :taking_estrogen, as: :radio_buttons, label: "If yes, are you taking estrogen?"
      .form-actions
        = submit_tag "Proceed to Release and Waiver of Liability", class: "btn-primary"
